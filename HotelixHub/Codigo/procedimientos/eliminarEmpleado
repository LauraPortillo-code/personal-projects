DELIMITER //
CREATE PROCEDURE `sp_eliminar_empleado`(
    IN p_id_usuario INT,
    IN p_id_usuario_eliminador INT
)
BEGIN
    DECLARE es_administrador INT;
    DECLARE tiene_reservas INT;
    
    -- Verificar si el usuario que elimina es administrador
    SELECT COUNT(*) INTO es_administrador 
    FROM usuarios 
    WHERE id_usuario = p_id_usuario_eliminador AND usu_idrol = 1;
    
    -- Verificar si el empleado tiene reservas asociadas
    SELECT COUNT(*) INTO tiene_reservas 
    FROM reserva 
    WHERE id_usuario = p_id_usuario;
    
    IF es_administrador = 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Solo los administradores pueden eliminar empleados';
    ELSEIF tiene_reservas > 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'No se puede eliminar el empleado porque tiene reservas asociadas';
    ELSE
        -- Eliminar el usuario
        DELETE FROM usuarios WHERE id_usuario = p_id_usuario;
        
        -- Verificar si se eliminó correctamente
        IF ROW_COUNT() = 0 THEN
            SIGNAL SQLSTATE '01000' SET MESSAGE_TEXT = 'No se encontró el empleado para eliminar';
        END IF;
    END IF;
END //
DELIMITER ;